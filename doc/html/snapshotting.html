<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Creating Snapshots &mdash; S3QL v0.8 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.8',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="S3QL v0.8 documentation" href="index.html" />
    <link rel="next" title="Other S3QL Commands" href="commands.html" />
    <link rel="prev" title="Unmounting" href="umount.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="commands.html" title="Other S3QL Commands"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="umount.html" title="Unmounting"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">S3QL v0.8 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul class="current">
<li class="toctree-l1"><a class="reference external" href="about.html">About S3QL</a></li>
<li class="toctree-l1"><a class="reference external" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference external" href="backends.html">Storage Backends</a></li>
<li class="toctree-l1"><a class="reference external" href="mkfs.html">File System Creation</a></li>
<li class="toctree-l1"><a class="reference external" href="mount.html">Mounting</a></li>
<li class="toctree-l1"><a class="reference external" href="umount.html">Unmounting</a></li>
<li class="toctree-l1 current"><a class="current reference external" href="">Creating Snapshots</a><ul>
<li class="toctree-l2"><a class="reference external" href="#snapshotting-vs-hardlinking">Snapshotting vs Hardlinking</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="commands.html">Other S3QL Commands</a></li>
<li class="toctree-l1"><a class="reference external" href="resources.html">Further Resources / Getting Help</a></li>
</ul>

          
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creating-snapshots">
<h1>Creating Snapshots<a class="headerlink" href="#creating-snapshots" title="Permalink to this headline">¶</a></h1>
<p>The command <tt class="docutils literal"><span class="pre">cp.s3ql</span></tt> can be used to duplicate a directory tree
without physically duplicating the file contents. This is made
possible by the data de-duplication feature of S3QL.</p>
<p>The syntax of <tt class="docutils literal"><span class="pre">cp.s3ql</span></tt> is:</p>
<div class="highlight-sh"><div class="highlight"><pre>cp.s3ql &lt;src&gt; &lt;target&gt;
</pre></div>
</div>
<p>This will replicate the contents of the directory <tt class="docutils literal"><span class="pre">&lt;src&gt;</span></tt> in the
directory <tt class="docutils literal"><span class="pre">&lt;target&gt;</span></tt>. <tt class="docutils literal"><span class="pre">&lt;src&gt;</span></tt> has to be an existing directory and
<tt class="docutils literal"><span class="pre">&lt;target&gt;</span></tt> must not exist. Moreover, both directories have to be
within the same S3QL file system.</p>
<p>The replication will not take any additional space. Only if one of
directories is modified later on, the modified data will take
additional storage space.</p>
<p>Note that:</p>
<ul class="simple">
<li>After the replication, both source and target directory will still
be completely ordinary directories. You can regard <tt class="docutils literal"><span class="pre">&lt;src&gt;</span></tt> as a
snapshot of <tt class="docutils literal"><span class="pre">&lt;target&gt;</span></tt> or vice versa. However, the most common
usage of <tt class="docutils literal"><span class="pre">cp.s3ql</span></tt> is to regularly duplicate the same source
directory, say <tt class="docutils literal"><span class="pre">documents</span></tt>, to different target directories. For a
e.g. monthly replication, the target directories would typically be
named something like <tt class="docutils literal"><span class="pre">documents_Januray</span></tt> for the replication in
January, <tt class="docutils literal"><span class="pre">documents_February</span></tt> for the replication in February etc.
In this case it is clear that the target directories should be
regarded as snapshots of the source directory.</li>
<li>Exactly the same effect could be achieved by an ordinary copy
program like <tt class="docutils literal"><span class="pre">cp</span> <span class="pre">-a</span></tt>. However, this procedure would be orders of
magnitude slower, because <tt class="docutils literal"><span class="pre">cp</span></tt> would have to read every file
completely (so that S3QL had to fetch all the data over the network
from the backend) before writing them into the destination folder.</li>
<li>Before starting with the replication, S3QL has to flush the local
cache. So if you just copied lots of new data into the file system
that has not yet been uploaded, replication will take longer than
usual.</li>
</ul>
<div class="section" id="snapshotting-vs-hardlinking">
<h2>Snapshotting vs Hardlinking<a class="headerlink" href="#snapshotting-vs-hardlinking" title="Permalink to this headline">¶</a></h2>
<p>Snapshot support in S3QL is inspired by the hardlinking feature that
is offered by programs like <a class="reference external" href="http://www.samba.org/rsync">rsync</a> or
<a class="reference external" href="http://savannah.nongnu.org/projects/storebackup">storeBackup</a>.
These programs can create a hardlink instead of copying a file if an
identical file already exists in the backup. However, using hardlinks
has two large disadvantages:</p>
<blockquote>
<ul class="simple">
<li>backups and restores always have to be made with a special program
that takes care of the hardlinking. The backup must not be touched
by any other programs (they may make changes that inadvertently
affect other hardlinked files)</li>
<li>special care needs to be taken to handle files which are already
hardlinked (the restore program needs to know that the hardlink was
not just introduced by the backup program to safe space)</li>
</ul>
</blockquote>
<p>S3QL snapshots do not have these problems, and they can be used with
any backup program.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="commands.html" title="Other S3QL Commands"
             >next</a></li>
        <li class="right" >
          <a href="umount.html" title="Unmounting"
             >previous</a> |</li>
        <li><a href="index.html">S3QL v0.8 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Nikolaus Rath.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.2.
    </div>
  </body>
</html>